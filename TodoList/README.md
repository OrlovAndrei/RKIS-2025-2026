# TodoList

Учебное консольное приложение на C# (.NET) для ввода данных пользователя и работы со списком задач.

## Что сделано:

### Базовая функциональность:
- Создано консольное приложение TodoList (папка `TodoList`)
- Добавлен стартовый вывод: "Работу выполнили Буряк Степан Геннадьевич и Голубев Данил Сергеевич"
- Реализован ввод имени, фамилии и года рождения, вычисление возраста и вывод сообщения вида:
  "Добавлен пользователь <Имя> <Фамилия>, возраст <N>"

### Объектно-ориентированная модель:
- класс `Profile` хранит данные пользователя и предоставляет метод `GetInfo()`
- класс `TodoItem` описывает одну задачу (текст, статус, дата изменения) и методы `MarkDone`, `UpdateText`, `GetShortInfo`, `GetFullInfo`
- класс `TodoList` управляет списком задач (`Add`, `Delete`, `View`, индексатор) и позволяет перебирать задачи через `foreach`

### Паттерн Command (лекция 7):
- Создан интерфейс `ICommand` с методом `Execute()` и `Unexecute()`
- Реализованы классы команд:
  - `HelpCommand` — вывод справки
  - `ExitCommand` — выход из программы
  - `ProfileCommand` — вывод информации о профиле
  - `AddCommand` — добавление задачи (с поддержкой флага `--multiline`)
  - `ViewCommand` — просмотр задач (с флагами `--no-index`, `--no-done`, `--no-date`)
  - `StatusCommand` — изменение статуса задачи
  - `DeleteCommand` — удаление задачи
  - `UpdateCommand` — обновление текста задачи
  - `ReadCommand` — вывод полной информации о задаче
- Создан статический класс `CommandParser` с методом `Parse()`, который:
  - Определяет команду по введённой строке
  - Разбирает флаги и параметры
  - Создаёт объект соответствующего класса команды
  - Присваивает объекту свойства `TodoList` или `Profile` в зависимости от назначения команды
  - Возвращает объект команды как `ICommand`
- Главный цикл программы переработан для использования паттерна Command

### Работа с файлами (лекция 8):
- Создан статический класс `FileManager` для работы с файлами и папками:
  - `EnsureDataDirectory(string dirPath)` — проверяет существование папки, создаёт её при необходимости
  - `SaveProfile(Profile profile, string filePath)` — сохраняет данные пользователя в `profile.txt`
  - `LoadProfile(string filePath)` — загружает данные пользователя из `profile.txt`
  - `SaveTodos(TodoList todos, string filePath)` — сохраняет задачи в CSV-файл `todo.csv`
  - `LoadTodos(string filePath)` — загружает задачи из CSV-файла
- Формат CSV-файла для задач: `Index;Text;Status;LastUpdate`
- Автоматическое сохранение данных после каждого изменения (команды `add`, `status`, `update`, `delete`, `profile`)
- Автоматическая загрузка данных при запуске программы из папки `data/`
- Использование классов `File`, `Directory`, `Path` для работы с файловой системой
-- Экранирование специальных символов в CSV (кавычки, переносы строк)

### Отмена и повтор действий (лекция 10):
- Статический класс `AppInfo` хранит общее состояние приложения:
  - `TodosByProfile` — словарь списков задач по идентификаторам пользователей
  - `Profiles` — список всех профилей пользователей
  - `CurrentProfileId` — идентификатор текущего активного профиля
  - `UndoStack` и `RedoStack` — стеки для реализации undo/redo
  - `DataDirectory` — путь к папке с данными
- Интерфейс `ICommand` расширен методом `Unexecute()` для отмены действий
- Реализованы команды:
  - `UndoCommand` — отмена последнего изменения (add/delete/update/status)
  - `RedoCommand` — повтор последнего отменённого изменения
- Все изменяющие команды (`add`, `delete`, `update`, `status`) после выполнения автоматически попадают в стек undo, а их отмена/повтор обновляют файлы с задачами
- При входе в новый профиль стеки undo/redo автоматически обнуляются

### Многопользовательская система:
- Класс `Profile` расширен полями:
  - `Id` (Guid) — уникальный идентификатор пользователя
  - `Login` — логин для входа
  - `Password` — пароль для входа
- Все профили сохраняются в файле `profile.csv` в формате: `Id;Login;Password;FirstName;LastName;BirthYear`
- При запуске программы предлагается войти в существующий профиль или создать новый
- Каждый пользователь имеет свой отдельный файл с заметками: `todos_<Id>.csv`
- Команда `profile --out` (или `profile -o`) позволяет выйти из текущего профиля и войти в другой
- Все команды работы с задачами (`add`, `update`, `delete`, `status`, `view`, `read`) работают только с задачами текущего профиля

## Многопользовательская система:

- При запуске программы предлагается войти в существующий профиль или создать новый
- Каждый пользователь имеет уникальный идентификатор (Guid), логин и пароль
- Все профили сохраняются в файле `data/profile.csv`
- Заметки каждого пользователя хранятся в отдельном файле `data/todos_<Id>.csv`
- При входе в профиль загружаются только заметки этого пользователя
- При выходе из профиля (команда `profile --out`) можно войти в другой профиль

## Команды:

- `help` — список доступных команд
- `profile` — выводит данные текущего пользователя в формате: `Имя Фамилия, возраст N`
- `profile --out` или `profile -o` — выход из текущего профиля (возврат к выбору профиля)
- `add "текст задачи"` — добавляет новую задачу; статус `не сделано`, дата — текущая
- `add --multiline` — добавляет задачу в многострочном режиме (ввод завершается пустой строкой)
- `view` — выводит задачи в табличном виде: индекс, сокращённый текст, статус, дата
- `view --no-index` — выводит задачи без индексов
- `view --no-done` — выводит задачи без статуса выполнения
- `view --no-date` — выводит задачи без даты
- `status <idx> <status>` — изменяет статус задачи (`notstarted`, `inprogress`, `completed`, `postponed`, `failed`)
- `delete <idx>` — удаляет задачу
- `update <idx> "новый текст"` — обновляет текст задачи и дату
- `read <idx>` — выводит полную информацию по задаче (`GetFullInfo()`)
- `undo` — отменяет последнее действие (add/delete/update/status)
- `redo` — повторяет последнее отменённое действие
- `exit` — завершает программу

## Работа с данными:

- При первом запуске программа создаст папку `data/` в текущей директории
- Все профили пользователей сохраняются в `data/profile.csv` в формате: `Id;Login;Password;FirstName;LastName;BirthYear`
- Список задач каждого пользователя сохраняется в отдельном файле `data/todos_<Id>.csv` в формате CSV: `Index;Text;Status;LastUpdate`
- При каждом запуске программа автоматически загружает все профили из `profile.csv`
- При входе в профиль загружаются заметки этого пользователя из соответствующего файла
- Все изменения автоматически сохраняются после выполнения команд в файл текущего пользователя
- При выходе из профиля стеки undo/redo обнуляются, чтобы команды отката не переносились между пользователями

## Как запустить (при установленном .NET SDK):

- Из корня репозитория: `dotnet run --project ./TodoList/TodoList.csproj`
