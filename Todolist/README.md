# Todolist

Практическое задание по дисциплине **РКИС** (группа 3834)

## Авторы
- Должиков
- Бут

## Что сделано
- Создано консольное приложение **Todolist**
- Добавлен `.gitignore`
- Реализована объектно-ориентированная архитектура
- Созданы классы: `TodoItem`, `TodoList`, `Profile`
- Реализован ввод профиля пользователя (имя, фамилия, год рождения)
- Автоматический расчёт возраста
- Реализована работа со списком задач
- Реализован паттерн **Command** для управления командами
- Создан класс `CommandParser` для парсинга и создания команд
- Реализована система отмены и повтора действий (undo/redo)
- Создан статический класс `AppInfo` для централизованного доступа к данным приложения

## Возможности программы

### Команды управления задачами:
- `help` — список всех команд
- `profile` — выводит данные профиля пользователя через метод `GetInfo()`
- `add "текст задачи"` — создаёт объект `TodoItem` и добавляет его в `TodoList`
- `add --multiline / -m` — добавляет многострочную задачу (завершить ввод командой `!end`)
- `view` — показывает все задачи (в порядке добавления)
- `view [flags]` — показывает задачи с дополнительной информацией:
  - `--index, -i` — показывать индекс задачи
  - `--status, -s` — показывать статус задачи
  - `--update-date, -d` — показывать дату последнего изменения
  - `--all, -a` — показывать все поля одновременно
  - Комбинации: `-is`, `-ds`, `-dis`
- `read <idx>` — выводит полное описание задачи через метод `Read()`
- `status <idx> <status>` — изменяет статус задачи через метод `SetStatus()`
  - Доступные статусы: `NotStarted`, `InProgress`, `Completed`, `Postponed`, `Failed`
  - Примеры: `status 2 InProgress`, `status 1 Completed`
- `delete <idx>` — удаляет задачу через метод `Delete()`
- `update <idx> "новый текст"` — обновляет текст задачи через метод `UpdateText()`
- `undo` — отменяет последнее действие (поддерживается для команд add, delete, update, status, profile)
- `redo` — повторяет последнее отменённое действие
- `exit` — завершает работу программы

## Архитектура

### Класс TodoItem
- **Свойства**: `Text`, `Status` (тип `TodoStatus`), `LastUpdate`
- **Enum TodoStatus**: `NotStarted`, `InProgress`, `Completed`, `Postponed`, `Failed`
- **Методы**: 
  - `UpdateText(string newText)` — изменяет текст и обновляет дату
  - `GetShortInfo()` — возвращает краткую информацию (30 символов)
  - `GetFullInfo()` — возвращает полное описание

### Класс TodoList
- **Приватное поле**: список задач `List<TodoItem>`
- **Методы**:
  - `Add(TodoItem item)` — добавить задачу
  - `Delete(int index)` — удалить задачу
  - `SetStatus(int index, TodoStatus status)` — изменить статус задачи и обновить дату
  - `View(bool showIndex, bool showStatus, bool showDate)` — вывод задач в виде таблицы с текстовыми статусами
  - `Read(int index)` — вывести полное описание задачи
  - `GetItem(int index)` — получить задачу по индексу
  - `Count` — свойство для получения количества задач

### Класс Profile
- **Свойства**: `FirstName`, `LastName`, `BirthYear`
- **Метод**: `GetInfo()` — возвращает строку "Имя Фамилия, возраст N"

### Класс AppInfo (статический)
- **Свойства**:
  - `Todos` — список задач (`TodoList`)
  - `CurrentProfile` — текущий профиль пользователя (`Profile`)
  - `UndoStack` — стек выполненных команд для отмены (`Stack<ICommand>`)
  - `RedoStack` — стек отменённых команд для повтора (`Stack<ICommand>`)
- **Назначение**: централизованное хранение данных приложения, доступных всем командам

### Паттерн Command

#### Интерфейс ICommand
- **Метод**: `Execute()` — выполнение команды
- **Метод**: `Unexecute()` — отмена действия команды

#### Классы команд (реализуют ICommand)
- **AddCommand** — добавление задачи
  - Свойства: `TodoList`, `Args` (string), `Multiline` (bool)
  - Создаёт `TodoItem` и добавляет его в `TodoList`
  
- **ViewCommand** — просмотр задач
  - Свойства: `TodoList`, `Args` (string), `ShowIndex` (bool), `ShowStatus` (bool), `ShowDate` (bool)
  - Вызывает `TodoList.View()` с соответствующими флагами
  
- **ReadCommand** — чтение задачи
  - Свойства: `TodoList`, `Index` (int)
  - Вызывает `TodoList.Read()`
  
- **StatusCommand** — изменение статуса задачи
  - Свойства: `TodoList`, `Index` (int), `Status` (TodoStatus)
  - Вызывает `TodoList.SetStatus()`
  
- **DeleteCommand** — удаление задачи
  - Свойства: `TodoList`, `Index` (int)
  - Вызывает `TodoList.Delete()`
  
- **UpdateCommand** — обновление задачи
  - Свойства: `TodoList`, `Index` (int), `NewText` (string)
  - Вызывает `TodoItem.UpdateText()`
  
- **ProfileCommand** — вывод профиля
  - Сохраняет старый профиль при обновлении для возможности отмены
  - Вызывает `Profile.GetInfo()`
  
- **UndoCommand** — отмена последнего действия
  - Извлекает команду из `UndoStack`
  - Вызывает `Unexecute()` для отмены действия
  - Перемещает команду в `RedoStack`
  
- **RedoCommand** — повтор последнего отменённого действия
  - Извлекает команду из `RedoStack`
  - Вызывает `Execute()` для повторного выполнения
  - Перемещает команду обратно в `UndoStack`

#### Класс CommandParser (статический)
- **Метод**: `Parse(string inputString)` — возвращает `ICommand?`
  - Определяет команду по введённой строке
  - Разбирает флаги и параметры
  - Создаёт объект соответствующего класса команды
  - Команды получают доступ к данным через `AppInfo`
  - Возвращает объект команды как `ICommand?`

## Работа программы

### Главный цикл (Main)
1. Инициализирует `AppInfo.Todos` и `AppInfo.CurrentProfile` при запуске
2. Считывает строку пользователя через `Console.ReadLine()`
3. Передаёт строку в `CommandParser.Parse()`
4. Получает объект `ICommand`
5. Вызывает `Execute()` для выполнения команды
6. Сохраняет команду в `UndoStack`, если она изменяет данные (add, delete, update, status, profile)
7. Очищает `RedoStack` при выполнении новой команды, изменяющей данные

### Пример работы:
```
>>> add "Купить молоко"
Задача добавлена: "Купить молоко"

>>> view -is
Ваши задачи:
...

>>> status 1 Completed
Статус задачи 1 изменён на: выполнено

>>> status 2 InProgress
Статус задачи 2 изменён на: в процессе

>>> delete 1
Задача 1 удалена.

>>> undo
Действие отменено.

>>> redo
Действие повторено.

>>> profile
Иван Петров, возраст 25
```

## Особенности
- Объектно-ориентированный дизайн
- Реализация паттерна **Command** для управления командами
- Централизованный парсинг команд через `CommandParser`
- Все поля классов приватные, доступ через свойства и методы
- Система статусов задач с использованием enum `TodoStatus`
- Поддержка 5 статусов: не начато, в процессе, выполнено, отложено, провалено
- Поддержка многострочных задач
- Гибкий вывод задач с различными комбинациями флагов
- Отображение статусов в текстовом виде (не true/false)
- Сохранение и загрузка данных в формате CSV
- Автоматическое сохранение статусов при изменении
- Система отмены и повтора действий (undo/redo)
- Централизованное хранение данных через `AppInfo`
- Сохранение истории команд для возможности отмены
- Удобное пошаговое управление через команды
- Расширяемость: легко добавить новые команды, создав новый класс, реализующий `ICommand`

## Система статусов задач

Задачи могут находиться в одном из следующих статусов:
- **NotStarted** (не начато) — задача создана, но ещё не начата
- **InProgress** (в процессе) — задача выполняется
- **Completed** (выполнено) — задача завершена
- **Postponed** (отложено) — задача временно отложена
- **Failed** (провалено) — задача не была выполнена или отменена

Статусы отображаются в текстовом виде при просмотре задач и сохраняются в CSV файл как строковые значения enum.

## Система отмены и повтора действий (Undo/Redo)

Программа поддерживает отмену и повтор действий через команды `undo` и `redo`.

### Принцип работы:

1. **Undo (отмена)**:
   - Извлекает последнюю команду из стека `UndoStack`
   - Вызывает метод `Unexecute()` для отмены действия
   - Перемещает команду в стек `RedoStack`

2. **Redo (повтор)**:
   - Извлекает последнюю команду из стека `RedoStack`
   - Вызывает метод `Execute()` для повторного выполнения
   - Перемещает команду обратно в стек `UndoStack`

### Поддерживаемые команды для отмены:

- `add` — отмена добавления задачи (задача удаляется)
- `delete` — отмена удаления (задача восстанавливается на прежнюю позицию)
- `update` — отмена обновления текста (восстанавливается предыдущий текст)
- `status` — отмена изменения статуса (восстанавливается предыдущий статус)
- `profile` — отмена обновления профиля (восстанавливается предыдущий профиль)

### Важные особенности:

- Новое действие, изменяющее данные, очищает стек `RedoStack`
- Команды просмотра (view, read) не сохраняются в стек отмены
- Команды undo и redo не сохраняются в стек отмены
- Все изменения автоматически сохраняются в файлы при выполнении и отмене
